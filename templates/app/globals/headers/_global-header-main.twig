{% import "@Elements/menus/_macro-menus.twig" as menus %}
{% import "@Elements/_macro-icon.twig" as icons %}
{% import "@Elements/_macro-logos.twig" as logos %}

{# Transparent header when Section Header Complex is the first section; otherwise white #}
{% set is_header_transparent = flexible_content is defined and flexible_content|length > 0 and flexible_content[0].component_name == 'section_header_complex' %}

<header x-data="{ 
        mobileNavOpen: false, 
        scrolledFromTop: false,
        logoScrolled: false,
        scrolledFromTopThreshold: 50,
        logoOpacityThreshold: 300,
        isHeaderTransparent: {{ is_header_transparent ? 'true' : 'false' }}
    }"
        id="site-header" 
        x-init="scrolledFromTop = window.pageYOffset >= scrolledFromTopThreshold; logoScrolled = window.pageYOffset >= logoOpacityThreshold"
        @scroll.window="scrolledFromTop = window.pageYOffset >= scrolledFromTopThreshold; logoScrolled = window.pageYOffset >= logoOpacityThreshold"
        :class="{
            'bg-white': !isHeaderTransparent,
            'bg-transparent site-header--over-hero': isHeaderTransparent && !scrolledFromTop
        }"
        class="fixed inset-x-0 top-0 z-10 px-4 site-header lg:px-8 js-header transition-colors duration-300 in-[.admin-bar]:top-[32px]"
>
    <!-- Main Header Content -->
    <div id="header-content" class="lg:container flex justify-between mx-auto xl:max-w-(--breakpoint-2xl) site-header__left">
        <!-- Left Section -->
        <div
            :class="[
                logoScrolled ? 'opacity-0' : 'opacity-100',
            ]"
            class="flex z-10 relative w-32 lg:w-64 transition-opacity duration-300 ease-in-out">
            <!-- Logo -->
            <a 
                href="{{ site.url }}" 
                :class="[
                    isHeaderTransparent ? 'bg-transparent pl- pr-4' : 'bg-white px-8',
                    'block rounded-b-sm  py-2 group absolute top-0 z-10 inset-x-0']">
                    <div :class="[
                        isHeaderTransparent ? 'hidden' : 'block',
                        'absolute inset-x-0 bg-white bottom-0 h-4 xl:h-1 2xl:h-10 shadow']"></div>
                <span 
                    :class="
                        isHeaderTransparent ? 
                    '[&_.logo-letters]:fill-white text-white' : '[&_.logo-letters]:fill-tiber-900 text-tiber-900'"
                    class="inline-flex w-full relative [&_.logo-accent]:fill-metallic-red-500 [&_.logo-accent]:transition-all [&_.logo-accent]:duration-300 group-hover:[&_.logo-accent]:fill-azure-500 hover:scale-105 transition-transform duration-300">
                    {{ logos.render_miranda_logo() }}
                </span>
                <span class="sr-only">{{ site.title }}</span>
            </a>
            <!-- END Logo -->
            
        </div>
        

        {# center navigation â€” white text over hero, dark when solid or scrolled #}
        <nav id="headerNavigation" 
             class="site-header__center w-full lg:px-8 xl:px-16 transition-colors duration-300 hidden lg:block main-header__nav"
             :class="isHeaderTransparent ? 'text-white' : 'text-gray-800'">
            {{ menus.render_mega_menu(menu.header_nav.get_items, {
                level: 0,
                classes: 'w-full',
                link_classes: [
                    is_header_transparent ? 'hover:[&>span]:text-tiber-300' : 'hover:[&>span]:text-metallic-red-600',
                    'sm:text-base uppercase font-bold py-3 px-0.5 bg-transparent transition-colors duration-300 [&>span]:rounded-sm',
                ],
                child_link_classes: [
                    'sm:text-sm uppercase font-bold py-3 px-0.5 bg-transparent transition-colors duration-300 [&>span]:rounded-sm hover:bg-gray-200 uppercase',
                ],
                })
            }}
        </nav>

        {# right actions #}
        <div id="headerActions" class="flex items-center justify-between space-x-4 header-actions site-header__right">

            <nav id="headerActions" class="hidden site-header__ctas lg:flex">
                {{ menus.render_buttons_menu(menu.header_buttons.get_items, {
                    over_hero: is_header_transparent,
                    style: 'secondary',
                    type: 'solid',
                    rest_style: 'white',
                    rest_type: 'outline white',
                }) }}
            </nav> 

            <!-- Open Mobile Navigation lg:hidden  -->
            <div class="header-actions__mobile-menu mobile-menu lg:hidden">
                <button 
                        x-on:click="mobileNavOpen = true" 
                    type="button" 
                    :class="isHeaderTransparent ? 'text-white' : 'text-gray-800'"
                    class="inline-flex items-center justify-center px-2 py-2 text-sm font-semibold leading-5  rounded-sm hover:border-gray-300 hover:text-gray-900 hover:shadow-xs focus:ring-3 focus:ring-gray-300 focus:ring-opacity-25 active:border-gray-200 active:shadow-none mobile-menu__toggle size-12" 
                    aria-controls="tkMobileNav">
                    {{ icons.icon({
                        path: 'controls',
                        name: 'bars-3-bottom-right',
                        classes: 'size-full',
                    }) }}
                    <span class="sr-only">Menu</span>
                </button>
            </div>
            <!-- END Open Mobile Navigation -->
        </div>
        <!-- END Right Section -->
    </div>
    <!-- END Main Header Content -->

    {% embed '@Layouts/slideovers/_component-slideover.twig' with {
            name: 'site-header__mobile-nav',
            trigger: 'mobileNavOpen',
            slideTitle: 'Navigation',
        }
    %}
        {% block slideContent %}
            {% import "@Elements/menus/_macro-menus.twig" as menus %}
            <nav class="flex flex-col items-start justify-between flex-1 space-y-4">

                 {{ menus.render_accordion_menu(menu.header_nav.get_items, {
                    level: 0,
                    classes: 'grid grid-cols-4 gap-8 mt-16 xl:mt-0',
                    link_classes: 'text-base font-semibold leading-6 text-gray-300 hover:text-white',
                    child_classes: 'text-sm leading-6 text-gray-300 mt-4 space-y-2',
                    child_link_classes: 'hover:text-white',
                
                }) }}
    
            </nav>
        {% endblock %}
    {% endembed  %}
</header>